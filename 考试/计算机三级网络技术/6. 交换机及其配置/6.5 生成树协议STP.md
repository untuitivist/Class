
## 1. STP的基本概念

+ 生成树协议(STP)是一个**二层链路管理协议**. 它主要功能是在保证网络中没有回路的基础上, **允许在第二层链路中提供冗余路经**, 以保证网络可靠、稳定地运行.
+ **IEEE 802.1D是最早的STP的标准**, 它提供了动态冗余切换机制, 是目前最为流行、应用最广泛的STP标准.
+ **STP运行在交换机和网桥设备**上, 通过计算建立一个稳定的树状结构网络, 来避免网络中回路的产生.

## 2. STP的工作原理

STP的工作过程为: **通过在交换机之间传递网桥协议数据单元**(BPDU), 并**运用生成树算法**(STA)对其进行比较计算.
+ 首先进行根网桥选择(根网桥为整个生成树拓扑结构的核心, 所有数据传输均通过根网桥)
+ 然后确定交换机冗余链路端口的工作状态, 让一些端口进入阻塞工作模式, 另一些端口进入转发工作模式
+ 其中设置为阻塞模式的端口不能进行数据流的转发和接收, 但仍作为一个激活的端口, 可进行BPDU的接收和读取

## 3. BPDU相关内容

BPDU中携带了实现生成树算法的有关信息, 包括: **Root ID、Root Path Cost、Bridge ID、Port ID、Hello time、Max Age**
+ BPDU数据包有两种类型, 一种是**包含配置信息的配置BPDU(不超过35个字节)**, 另一种是**包含拓扑变化信息的拓扑变化通知BPDU(不超过4个字节)**
+ 在配置BPDU包的Bridge ID信息, 是选取根网桥或根交换机的主要依据
+ 一般情况下, Bridge ID值最小的成为根网桥或根交换机
+ Bridge ID用8个字节标识, 后6个字节为交换机的MAC地址, 前2个字节为优先级值
+ 优先级值越小, 优先级越高(根网桥或根交换机)
+ **优先级取值范围为0~61440, 增值量为4096, 交换机的优先级一般默认为32768**, 可以使用命令人工设置
+ 一台交换机的优先级设置为8189, 优先级高级其他交换机, 会成为根交换机
+ 选择根网桥时, 优先级相同, 会根据MAC地址的值决定根网桥, **MAC的值最小的为根网桥**
+ 默认情况下, 交换机**每2秒定时发送一次BPDU**, 当检测到网络拓扑变化或故障发生时, 也会发送新的BPDU, 以及时进行生成树的更新


















